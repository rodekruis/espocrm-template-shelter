{
    "beforeSaveCustomScript": "// Combine name\nif (extraName != null) {\n    name = string\\concatenate(firstName, string\\concatenate(extraName, \" \", lastName));\n} else {\n    name = string\\concatenate(firstName,\" \", lastName);\n};\n\n// Calculate age\n$today = datetime\\today();\nage = datetime\\diff($today, dateofbirth,'years');\n\n// If HH is unassigned but this PA is HHH\nif (cHouseholdId == null && cHouseholdHOId != null) {\n    // 1. remove this PA as HHH\n    $HHId = cHouseholdHOId;\n    cHouseholdHOId = null;\n    // 2. assign oldest member of HH as new HHH\n    $oldestPersonAffectedId = record\\findRelatedOne('CHousehold', $HHId, 'cPersonAffected', 'age', 'desc', 'cHouseholdId=', $HHId, 'id!=', id);\n    if ($oldestPersonAffectedId) {\n        record\\update('CHousehold', $HHId, 'cHeadOfHouseHoldId', $oldestPersonAffectedId);\n    };\n};"
}